---
description: 
globs: 
alwaysApply: true
---
# Mozart Cloud Terraform í”„ë¡œì íŠ¸ MDC ë£°

## ğŸ¯ ëª©ì 
Mozart Cloud ì¸í”„ë¼ ë¦¬ì†ŒìŠ¤ë¥¼ Terraformìœ¼ë¡œ êµ¬ì„±í•  ë•Œ ì¼ê´€ëœ **ë¦¬ì†ŒìŠ¤ ë„¤ì´ë°**ê³¼ **ì½”ë”© ìŠ¤íƒ€ì¼**ì„ ìœ ì§€í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ ê°€ë…ì„±ì„ ë†’ì´ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.

---

## âœ… ê¸°ë³¸ ì½”ë”© í¬ë§· ë°©ì•ˆ

### Terraform ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
- **Indent**: ìŠ¤í˜ì´ìŠ¤ 2ì¹¸
- **ë³€ìˆ˜ëª…/ë¦¬ì†ŒìŠ¤ëª…**: ì†Œë¬¸ìì™€ ëŒ€ì‹œ (`kebab case`) ì‚¬ìš©
- **ëª¨ë“ˆí™”**: ê°™ì€ íƒ€ì…ì˜ ë¦¬ì†ŒìŠ¤ê°€ ë°˜ë³µë˜ê±°ë‚˜ ì—¬ëŸ¬ í™˜ê²½(dev/stg/prd)ì—ì„œ ì‚¬ìš©ë  ê²½ìš° `module`ë¡œ êµ¬ì„±
- **íŒŒì¼ ë¶„ë¦¬ ê¶Œì¥**:
  - `main.tf`: ë¦¬ì†ŒìŠ¤ ì •ì˜
  - `variables.tf`: ë³€ìˆ˜ ì •ì˜
  - `outputs.tf`: ì¶œë ¥ê°’ ì •ì˜
  - `locals.tf`: ì§€ì—­ ë³€ìˆ˜ ì •ì˜
  - `provider.tf`: provider ë° backend ì„¤ì •
- **ë¶ˆí•„ìš”í•œ ì£¼ì„ ì§€ì–‘**: ì¼ë°˜ì ì¸ ì„¤ëª…ì„ ìœ„í•œ ì£¼ì„ì€ ì‘ì„±í•˜ì§€ ì•ŠìŒ
---

## ğŸ“› ë¦¬ì†ŒìŠ¤ ì´ë¦„ ê·œì¹™

### ê¸°ë³¸ ë„¤ì´ë° í¬ë§·

```hcl
name = format(
  "%s%s-%s-%s-%s",
  var.project_key,    # ì˜ˆ: vms, mzc
  awsservice,         # ì˜ˆ: ecs, s3, rds ë“±
  var.system,         # ì˜ˆ: aps, dp, cp ë“± - ìƒëµ ê°€ëŠ¥
  var.service,        # ì˜ˆ: frontend, backend, engine ë“± (flat caseë§Œ í—ˆìš©)
  var.env             # ì˜ˆ: prd, stg, dev - ìƒëµ ê°€ëŠ¥
)
```

### ë„¤ì´ë° ê·œì¹™ ìš”ì•½

- **ì „ì²´ ë¦¬ì†ŒìŠ¤ëª…ì€ kebab case**ë¡œ ì‘ì„±  
- **ë‹¨ì¼ ë³€ìˆ˜ëª…ì€ flat caseë§Œ í—ˆìš©**  
  ì˜ˆ) `frontend`, `demandforcast`, `dataexplorer`
- **`-`(í•˜ì´í”ˆ)**ì€ ì„œë¡œ ë‹¤ë¥¸ ê°œë… (`project_key`, `system`, `env`)ì„ êµ¬ë¶„í•  ë•Œ ì‚¬ìš©  
- `system`, `service`, `env`ëŠ” ë¶ˆë¶„ëª…í•˜ê±°ë‚˜ ê³µìš©ì¼ ê²½ìš° ìƒëµ ê°€ëŠ¥

---

## â˜‘ï¸ í™˜ê²½ ë³€ìˆ˜ì— ë”°ë¥¸ ì¡°ê±´ì  ìƒëµ ê·œì¹™

- ê³µí†µ íƒœê·¸ `common_tags` ë³€ìˆ˜ëŠ” ë™ì¼ í´ë” ë‚´ì˜ `variables.tf` íŒŒì¼ì—ì„œ ì •ì˜ë˜ë©°, í•´ë‹¹ default ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ì´ë¦„ ë„¤ì´ë° ë°©ì‹ì„ ê²°ì •í•©ë‹ˆë‹¤.
- `common_tags.Environment`ì˜ **default ê°’ì´ `"all"`**ë¡œ ì„¤ì •ëœ ê²½ìš°, **ëª¨ë“  ë¦¬ì†ŒìŠ¤ì˜ ì´ë¦„ì—ì„œ `var.env` ê°’ì€ ìƒëµ**í•©ë‹ˆë‹¤.
- ì´ ê·œì¹™ì€ **ì½”ë”© ì‹œì ì— í•˜ë“œì½”ë”©ìœ¼ë¡œ ì ìš©**í•´ì•¼ í•˜ë©°, `var.env` ê°’ì„ ì¡°ê±´ë¬¸(`if` ë¬¸, ì‚¼í•­ ì—°ì‚°ì ë“±)ìœ¼ë¡œ ë¶„ê¸°í•˜ì—¬ ì²˜ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ì¦‰, `Environment`ì˜ defaultê°€ `"all"`ì¸ ê²½ìš°ì—ëŠ” `format()` í•¨ìˆ˜ ë‚´ì— `var.env`ë¥¼ í¬í•¨í•˜ì§€ ì•Šë„ë¡ ì‘ì„±í•©ë‹ˆë‹¤.

### âœ… ì˜ëª»ëœ ì˜ˆ (ì¡°ê±´ë¬¸ ì‚¬ìš© â€“ âŒ ì§€ì–‘)
```hcl
locals {
  hyperbilling_role_name = var.env == "all" ?
    format("%s%s-%s", var.project_key, "iam", "HyperbillingS3ReadRole") :
    format("%s%s-%s-%s", var.project_key, "iam", "HyperbillingS3ReadRole", var.env)
}
resource "aws_iam_role" "hyperbilling_s3_read_role" {
  name        =  locals.hyperbilling_role_name
}
```

### âœ… ì˜¬ë°”ë¥¸ ì˜ˆ (í•˜ë“œì½”ë”© â€“ âœ… ê¶Œì¥)
```
# common_tags.Environment ì˜ default ê°’ì´ "all"ì¸ ê²½ìš°
resource "aws_iam_role" "hyperbilling_s3_read_role" {
  name        =  format("%s%s-%s", var.project_key, "iam", "HyperbillingS3ReadRole")
}
```

### ğŸ“Œ ì£¼ì˜
ì´ ë°©ì‹ì€ variables.tf íŒŒì¼ì— default ê°’ì´ ëª…ì‹œë˜ì–´ ìˆì„ ê²½ìš°ì—ë§Œ ì ìš©í•©ë‹ˆë‹¤.

ë‹¤ë¥¸ í™˜ê²½(dev/stg/prd)ì„ ì‚¬ìš©í•  ë•Œì—ëŠ” í•´ë‹¹ í™˜ê²½ì—ì„œ Environment ê°’ì„ ì˜¤ë²„ë¼ì´ë“œí•˜ë„ë¡ í•˜ê³ , ê·¸ì— ë”°ë¼ var.env í¬í•¨ ì—¬ë¶€ë„ ëª…í™•íˆ í•˜ë“œì½”ë”©í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ’¼ IAM Role, Policy ë„¤ì´ë° íŠ¹ì¹™

- `var.service` ìë¦¬ì—ëŠ” ì—­í• ì„ ëª…í™•íˆ ë‚˜íƒ€ë‚´ëŠ” **PascalCase í‚¤ì›Œë“œ**ë¥¼ ì‚¬ìš©
- ì˜ˆì‹œ í˜•ì‹:

```hcl
name = format("%s%s-%s-%s", var.project_key, "iam", "EcsExecPolicy", var.env)
```

- ê²°ê³¼ ì˜ˆì‹œ: `mzciam-EcsExecPolicy-prd`

---

## ğŸ’¡ ì˜ˆì œ

### ECS ì„œë¹„ìŠ¤ ì˜ˆì‹œ

```hcl
resource "aws_ecs_service" "main" {
  name = format(
    "%s%s-%s-%s-%s",
    var.project_key,    # "mzc"
    "ecs",              # AWS ì„œë¹„ìŠ¤
    var.system,         # "dp"
    var.service,        # "backend" (flat caseë§Œ í—ˆìš©)
    var.env             # "prd"
  )
}
# ê²°ê³¼: mzcecs-dp-backend-prd
```

### S3 ë²„í‚· ì˜ˆì‹œ (ê³µìš© ë²„í‚·ìœ¼ë¡œ service ìƒëµ)

```hcl
resource "aws_s3_bucket" "main" {
  bucket = format("%s%s-%s-%s", var.project_key, "s3", system, var.env)
}
# ê²°ê³¼: mzcs3-aps-prd
```

### IAM Policy ì˜ˆì‹œ

```hcl
resource "aws_iam_policy" "ecs_exec_policy" {
  name = format("%s%s-%s-%s", var.project_key, "iam", "EcsExecPolicy", var.env)
}
# ê²°ê³¼: mzciam-EcsExecPolicy-prd
```

---

## ğŸ“› description ë„¤ì´ë° ê·œì¹™ ìš”ì•½

- **ë¬´ì¡°ê±´ ì˜ì–´**ë¡œë§Œ ì‘ì„± (AWSì—ì„œ í•œê¸€ ì§€ì›í•˜ì§€ ì•ŠëŠ” ì„œë¹„ìŠ¤ë“¤ ì¡´ì¬)